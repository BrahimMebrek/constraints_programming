using CP;

int n = ...;

{int} women;
{int} men;

{int} preference[women][men];

dvar boolean x[women][men];

minimize sum(w in women, m in men) x[w][m];

subject to {
    forall(w in women, m in men)
        x[w][preference[w][m]-1][m] >= x[w][m];

    forall(w in women)
        sum(m in men) x[w][m] == 1;
    
    forall(m in men)
        sum(w in women) x[w][m] == 1;

    forall(w in women)
        forall(m1 in preference[w])
            forall(m2 in preference[w] : m1 < m2)
                x[w][m1-1][w] + x[m1][w] <= 
                x[w][m2-1][w] + x[m2][w];
}
